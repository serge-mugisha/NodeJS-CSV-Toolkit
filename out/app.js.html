<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: app.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: app.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const fs = require('fs')
const { parse } = require('csv-parse')
const Incident = require('./dto/Incident')

const filepath = './PICD.csv'

// Open IO and get data stream from the file
try {
    console.log("Opening file IO with Nodejs fs API module and reading the file at path: ", filepath, "\n -- Program by Serge Mugisha -- \n")
    /** 
     * This variable stores the data stream of the file
     * @type {string}
    */
    var dataStream = fs.readFileSync(filepath)

    // Parse the CSV, select few records, and filter desired columns and execute the callback after processing
    prepareRecords(dataStream, (results) => {
        // Output stored results
        console.log("\n Logging the stored resuls \n-- Program by Serge Mugisha -- \n")
        for (record in results) console.log(results[record])
        console.log("Program by Serge Mugisha :)")
    });

} catch (err) {
    if (err.code === 'ENOENT') {
        console.log('File not found!');
    } else {
        console.log(err.message);
    }
}

/**
 * This function Parses passed csv file stream to an array of arrays as rows
 * @function
 * @param {string} dataStream - Holds the file stream to be parsed and prepared
 * @param {function} callBack - Callback function to be executed after processing the data
*/
function prepareRecords(dataStream, callBack) {
    try {
        // Parse the CSV dataStream to an array of rows &amp; filter needed columns
        console.log("Parsing the stored CSV data stream to an array of rows \n -- Program by Serge Mugisha -- \n")

        parse(dataStream, { columns: false, trim: true }, (err, rows) => {
            if (err) throw new Error("Error parsing file!", err)

            /** 
             * Stores parsed incident records from the csv file
             * @type {Array&lt;string>} 
             */
            var parsedData = []
            // Select the first 5 rows from the csv exclusing column names
            console.log("Storing the first 5 records of the dataset (excluding column names) in a separate array. \n -- Program by Serge Mugisha -- \n")
            for (var i = 1; i &lt;= 5; i++) {
                parsedData.push(rows[i])
            }

            /** 
             * This variable stores the parsed and filtered incident records.
             * @type {Array&lt;object>}
            */
            var filteredData = []
            // Filter the columns from selected rows and create an object for each record
            console.log("Filtering columns from selected rows and creating an object for each record. \n -- Program by Serge Mugisha -- \n")
            for (var i = 0; i &lt; 5; i++) {
                /** 
                 * Stores individual record after filtering needed columns from the original data.
                 * @type {Array&lt;string>}
                */
                var record = []
                var columnIndexes = [0, 1, 2, 3, 4, 5, 10, 12, 17];
                columnIndexes.map(index => record.push(parsedData[i][index]))

                console.log("Creating and instantiating Incident record object: ", record[0])
                /** 
                 * Stores Incident record object instance after filtering needed columns from the original record.
                 * @type {object}
                */
                var incindent = new Incident(record[0], record[1], record[2], record[3], record[4], record[5], record[6], record[7], record[8])

                filteredData.push(incindent)
            }

            // return prepared data
            callBack(filteredData);

        })
    } catch (err) {
        if (err.code === 'ENOENT') {
            console.log('File not found!');
        } else {
            console.log(err.message);
        }
    }
}</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Incident.html">Incident</a></li></ul><h3>Global</h3><ul><li><a href="global.html#dataStream">dataStream</a></li><li><a href="global.html#prepareRecords">prepareRecords</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.10</a> on Thu Jan 27 2022 14:38:00 GMT-0500 (Eastern Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
